jQuery(function(e){e(document).ready(function(){let e=document.querySelectorAll(".dsm-filterable-gallery-container");e.forEach((e,t)=>{let a=e.dataset.use_lightbox,i=e.querySelector(".dsm-filterable-gallery-inner-container");"on"===a&&jQuery(i).magnificPopup({delegate:".dsm-filterable-gallery-item",type:"image",tLoading:"Loading image ",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image </a> could not be loaded.',titleSrc:function(e){let t=e.el[0].dataset.lightbox_title,a=e.el[0].dataset.lightbox_caption,i=e.el[0].dataset.lightbox_description,r="";return r+=void 0===t||""===t?"":t,r+=void 0===a||""===a?"":"<small class='dsm-filterable-image-caption'>"+a+"</small>",r+=void 0===i||""===i?"":"<small class='dsm-filterableimage-description'>"+i+"</small>"}}})}),e.forEach(e=>{let t=e.querySelector(".dsm-filterable-gallery-inner-container"),a=e.querySelector(".dsm-gallery-loadmore-container"),i=e.querySelector(".dsm-gallery-number-pagination-container"),r=e.querySelectorAll(".dsm-filterable-gallery-filter-item"),l=Number(e.dataset.per_page),n="on"===e.dataset.showpagination,s=e.dataset.paginationtype,d=Number(e.dataset.speed),o=new Shuffle(t,{itemSelector:".dsm-filterable-gallery-item",delimiter:",",speed:d,buffer:1}),c=new IntersectionObserver(e=>{e[0].intersectionRatio>=.5&&o.update(),e[0].isIntersecting&&o.update()});function g(){let e=Array.from(r).find(e=>e.classList.contains("dsm-active-filter"));return e&&e.hasAttribute("data-category")&&"undefined"!==e.dataset.category?e.dataset.category:"all"}function u(t){let a=e.querySelectorAll(".dsm-filterable-gallery-item"),i=Array.from(a).filter(e=>e.dataset.groups.split(",").includes(t)),r=n?l:i.length,s=function e(t,a){for(var i=[],r=0,l=t.length;r<l;)i.push(t.slice(r,r+=a));return i}(i,r);a.forEach(e=>{e.setAttribute("data-inpage","-1")}),s.forEach((e,t)=>{let a=t+1;e.forEach(e=>{e.setAttribute("data-inpage",a.toString())})}),e.setAttribute("data-totalPages",s.length);let d=e.querySelectorAll(".dsm-filterable-gallery-item"),o=Array.from(d).filter(a=>{let i=Number(a.dataset.inpage),r=a.dataset.groups.split(",").includes(t),l=Number(e.dataset.currentpage)+1;return i===l&&r}),c=Array.from(d).filter(a=>{let i=Number(a.dataset.inpage),r=a.dataset.groups.split(",").includes(t),l=Number(e.dataset.currentpage)-1;return i===l&&r}),g=o.length>0,u=c.length>0;e.setAttribute("data-hasnextpage",String(g)),e.setAttribute("data-hasPrevpage",String(u))}function p(){if(!i)return;let t=i.querySelectorAll(".dsm-gallery-number-pagination"),a=Number(e.dataset.currentpage)>1,r="true"===e.dataset.hasnextpage;t.forEach(i=>{isNaN(i.dataset.pagination)||r||a||(i.style.display="none"),Number(e.dataset.currentpage)===Number(i.dataset.pagination)&&i.classList.add("dsm-active-pagination-item"),i.addEventListener("click",()=>{r="true"===e.dataset.hasnextpage,t.forEach(e=>e.classList.remove("dsm-active-pagination-item"));let l=Number(e.dataset.currentpage),n=i.dataset.pagination,s=g();switch(a=l>1,n){case"next":{if(!r)return;let d=l+1;t.forEach(e=>{let t=e.dataset.pagination;d===Number(t)&&e.classList.add("dsm-active-pagination-item")}),e.setAttribute("data-currentpage",d),m(s,d)}break;case"prev":{if(!a)return;let o=l-1;t.forEach(e=>{let t=e.dataset.pagination;o===Number(t)&&e.classList.add("dsm-active-pagination-item")}),e.setAttribute("data-currentpage",o),m(s,o)}break;default:i.classList.add("dsm-active-pagination-item"),e.setAttribute("data-currentpage",n),m(s,Number(n))}})})}function m(t,a=e.dataset.currentpage){var i;a=Number(e.dataset.currentpage),o.filter(e=>{let i=Number(e.dataset.inpage),r=e.dataset.groups,l=("number"===s?i===a:i<=a)&&-1!==i,n=r.split(",").includes(t);return n&&l}),i=t,r.forEach(e=>{let t=e.dataset.category;i===t?e.classList.add("dsm-active-filter"):e.classList.remove("dsm-active-filter")}),u(t)}c.observe(t),r.forEach(t=>{t.addEventListener("click",()=>{let a=t.dataset.category;u(a),e.setAttribute("data-currentpage","1"),m(a),i&&function t(){let a=Number(e.dataset.totalpages);i.innerHTML="";let r=document.createElement("span");r.classList.add("dsm-gallery-number-pagination"),r.setAttribute("data-pagination","prev"),r.innerHTML="Prev",i.appendChild(r),Array(a).fill(0).map((e,t)=>{let a=t+1,r=document.createElement("span");r.innerHTML=a,r.classList.add("dsm-gallery-number-pagination"),r.setAttribute("data-pagination",a),i.appendChild(r)});let l=document.createElement("span");l.classList.add("dsm-gallery-number-pagination"),l.setAttribute("data-pagination","next"),l.innerHTML="Next",i.appendChild(l),p()}()})}),a&&a.addEventListener("click",()=>(function t(){let a=Number(e.dataset.currentpage),i=a+1,r=g();e.setAttribute("data-currentpage",i.toString()),u(r),m(r,i)})());let f=void 0!==r[0]?r[0].dataset.category:"all";u(f),m(f),p()})})});