jQuery(function($) {
  $(".dsm_blog_carousel").each(function(index, value) {
    let $this = $(this);
    let data = $this.find(".dsm-blog-carousel").data();
    let selector =
      "." +
      $this
        .attr("class")
        .split(" ")
        .join(".") +
      " .swiper-container";

    let navigation = {
      nextEl: ".dsm-arrow-button-next" + data.ordernumber,
      prevEl: ".dsm-arrow-button-prev" + data.ordernumber,
    };
    let pagination = {
      el: ".dsm-pagination" + data.ordernumber,
      clickable: true,
      type: "progressbar" !== data.pagiButtonStyle ? "bullets" : "progressbar",
      dynamicBullets: "dynamic" === data.pagiButtonStyle ? true : false,
    };

    let carousel_direction = data.orientation;
    let loop_infinte = data.loop === 1 ? true : false;
    let centered_slides = data.centered === "on" ? true : false;
    let touch_move = data.touchMove === "on" ? false : true;
    let grab = data.grab === "on" ? true : false;

    let DSM_BlogCarousel = new Swiper(selector, {
      effect: data.effect,
      direction: carousel_direction,
      autoHeight: true,
      coverflowEffect: {
        slideShadows: data.effectShadows === "on" ? true : false,
        rotate: data.effectCoverflowRotate,
        depth: data.effectCoverflowDepth,
      },
      flipEffect: {
        rotate: 30,
        slideShadows: data.effectShadows === "on" ? true : false,
      },
      cubeEffect: {
        slideShadows: data.effectShadows === "on" ? true : false,
        shadow: data.effectShadows === "on" ? true : false,
        shadowOffset: 20,
        shadowScale: 0.94,
      },
      /* For some reason new SWIPER does not take in this.
            slidesPerView: 'cube' === data.effect || 'flip' === data.effect ? 1 : Number(data.columnsdesktop),
            spaceBetween: 'cube' === data.effect || 'flip' === data.effect ? 0 : Number(data.spacing),
            */
      speed: Number(data.speed),
      loop:
        centered_slides === true
          ? true
          : data.multiRow === "on"
          ? false
          : loop_infinte,
      autoplay: {
        //enabled: params[0]['autoplay'],
        enabled: false,
        delay: data.autoplayspeed,
        disableOnInteraction: false,
      },
      mousewheel: data.mousewheel === "on" ? true : false,
      /*
            autoplay: "on" === data.autoplay && {
                delay: data.autoplayspeed
            },*/
      setWrapperSize:
        "cube" === data.effect || "flip" === data.effect ? false : true,
      observer: true,
      observeParents: true,
      observeSlideChildren: true,
      slideClass: "dsm-blog-carousel-item",
      wrapperClass: "dsm-blog-carousel-wrapper",
      navigation: navigation,
      pagination: pagination,
      centeredSlides: centered_slides,
      slidesPerColumn: data.multiRow === "on" ? Number(data.row) : 2,
      slidesPerColumnFill: "row",
      grabCursor: false === touch_move ? false : grab,
      allowTouchMove: touch_move,
      breakpoints: {
        320: {
          slidesPerView:
            "cube" === data.effect || "flip" === data.effect
              ? 1
              : Number(data.columnsphone),
          spaceBetween:
            "cube" === data.effect || "flip" === data.effect
              ? 0
              : Number(data.spacingphone),
          slidesPerColumn: data.multiRow === "on" ? Number(data.rowsphone) : 1,
          slidesPerColumnFill: "row",
        },
        480: {
          slidesPerView:
            "cube" === data.effect || "flip" === data.effect
              ? 1
              : Number(data.columnsphone),
          spaceBetween:
            "cube" === data.effect || "flip" === data.effect
              ? 0
              : Number(data.spacingphone),
          slidesPerColumn: data.multiRow === "on" ? Number(data.rowsphone) : 1,
          slidesPerColumnFill: "row",
        },
        768: {
          slidesPerView:
            "cube" === data.effect || "flip" === data.effect
              ? 1
              : Number(data.columnstablet),
          spaceBetween:
            "cube" === data.effect || "flip" === data.effect
              ? 0
              : Number(data.spacingtablet),
          slidesPerColumn: data.multiRow === "on" ? Number(data.rowstablet) : 1,
          slidesPerColumnFill: "row",
        },
        981: {
          slidesPerView:
            "cube" === data.effect || "flip" === data.effect
              ? 1
              : Number(data.columnsdesktop),
          spaceBetween:
            "cube" === data.effect || "flip" === data.effect
              ? 0
              : Number(data.spacing),
          slidesPerColumn: data.multiRow === "on" ? Number(data.row) : 1,
          slidesPerColumnFill: "row",
        },
      },
    });

    if (data.pauseOnHover === "on") {
      $(this).on("mouseenter", function(e) {
        DSM_BlogCarousel.autoplay.stop();
      });
      $(this).on("mouseleave", function(e) {
        DSM_BlogCarousel.autoplay.start();
      });
    }
    if (data.autoplay === "on") {
      if (typeof DSM_BlogCarousel === "undefined") {
        DSM_CardSwiper.autoplay.start();
      } else {
        var waypoint = new Waypoint({
          element: $(this),
          handler: function(direction) {
            DSM_BlogCarousel.autoplay.start();
            this.destroy();
          },
          offset: data.autoplayViewport,
        });
      }
    }
  });
});
